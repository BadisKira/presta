<p-toolbar styleClass="mb-4">
    <ng-template pTemplate="left">
        <p-button label="Actualiser" icon="pi pi-refresh" (onClick)="load()" />
    </ng-template>
    <ng-template pTemplate="right">
        <p-button label="Exporter" icon="pi pi-download" (onClick)="exportCSV()" />
    </ng-template>
</p-toolbar>

<p-table #dt
    [value]="contractors()"
    [lazy]="true"
    [paginator]="true"
    [rows]="size"
    [totalRecords]="totalRecords()"
    [loading]="loading()"
    (onLazyLoad)="onLazyLoad($event)"
    [rowsPerPageOptions]="[10, 20, 50]"
    dataKey="id"
    styleClass="p-datatable-sm">
    
    <!-- <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
            <span class="text-xl">Contractors</span>
            <input pInputText type="text" (input)="search($any($event.target).value)" 
                   placeholder="Rechercher..." class="w-20rem" />
        </div>
    </ng-template> -->





<ng-template pTemplate="caption">
        <div class="flex items-center justify-between">
            <h5 class="m-0">Gérer les Préstataires</h5>
            <div class="flex gap-2">
                <p-iconfield>
                    <p-inputicon styleClass="pi pi-search" />
                    <input pInputText type="text" (input)="search($any($event.target).value)" 
                        placeholder="Recherche par nom..." />
                </p-iconfield>
                <!-- <p-button icon="pi pi-times" severity="secondary" [outlined]="true" (onClick)="clearSearch()"
                    [disabled]="!searchTerm" pTooltip="Effacer la recherche" /> -->
            </div>
        </div>
    </ng-template>





    <ng-template pTemplate="header">
        <tr>
            <th pSortableColumn="fullName">Nom <p-sortIcon field="fullName" /></th>
            <th>Email</th>
            <th>Spécialité</th>
            <th>Adresse</th>
            <th>Mission</th>
            <th>Statut</th>
            <th>Actions</th>
        </tr>
    </ng-template>

    <ng-template pTemplate="body" let-c>
        <tr>
            <td>{{ c.fullName }}</td>
            <td>{{ c.user.contactInfo.email }}</td>
            <td>{{ c.speciality || '-' }}</td>
            <td>{{ c.address || '-' }}</td>
            <td>{{ c.assignment?.name || '-' }}</td>
            <td>
                <p-tag [severity]="c.user.isActive ? 'success' : 'danger'">
                    {{ c.user.isActive ? 'Actif' : 'Banni' }}
                </p-tag>
            </td>
            <td>
                <p-button icon="pi pi-ban" [text]="true" [rounded]="true"
                    [severity]="c.user.isActive ? 'danger' : 'success'"
                    (onClick)="toggleStatus(c)"
                    [pTooltip]="c.user.isActive ? 'Bannir' : 'Réactiver'" />
            </td>
        </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
        <tr>
            <td colspan="7" class="text-center">
                {{ loading() ? 'Chargement...' : 'Aucun contractor trouvé' }}
            </td>
        </tr>
    </ng-template>
</p-table>

<p-confirmDialog />